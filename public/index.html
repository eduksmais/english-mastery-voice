<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Mastery — Text Coach</title>
<style>
  :root {
    --teal:#31c1bb; --yellow:#f5b305; --orange:#e34410; --black:#0C0101; --white:#ffffff;
  }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
         background:#fff; margin:0; display:flex; flex-direction:column; align-items:center; }
  header { background: var(--teal); color:#fff; width:100%; padding:16px; text-align:center; font-weight:600; }
  #chat { width:100%; max-width:700px; height:70vh; border:1px solid #e5e7eb; border-radius:14px;
          overflow-y:auto; padding:16px; margin-top:16px; background:#f8fafc; display:flex; flex-direction:column; gap:10px; }
  .msg { padding:10px 14px; border-radius:12px; max-width:80%; line-height:1.45; word-wrap:break-word; }
  .user { align-self:flex-end; background: #e7fff9; border:1px solid rgba(49,193,187,.35); }
  .bot  { align-self:flex-start; background:#fff; border:1px solid #e5e7eb; }
  #controls { margin-top:12px; display:flex; width:100%; max-width:700px; gap:8px; }
  input { flex:1; padding:12px; border-radius:10px; border:1px solid #cbd5e1; }
  button { background:var(--orange); color:#fff; border:none; padding:12px 20px; border-radius:10px; font-weight:700; cursor:pointer; }
  button:hover { background:var(--yellow); color:var(--black); }
  .status { margin-top:8px; font-size:12px; color:#64748b; }
</style>
</head>
<body>
  <header>English Mastery — Text Coach</header>
  <div id="chat"></div>
  <div id="controls">
    <input type="text" id="input" placeholder="Write your message..." />
    <button id="send">Send</button>
  </div>
  <div class="status" id="status"></div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");
const statusEl = document.getElementById("status");

function addMessage(text, who="bot") {
  const msg = document.createElement("div");
  msg.className = "msg " + who;
  msg.textContent = text;
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  addMessage(text, "user");
  input.value = "";
  statusEl.textContent = "Thinking…";

  try {
    const r = await fetch("/respond", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await r.json();
    if (!r.ok || !data?.ok) {
      addMessage("Server error. (" + (data?.error || r.status) + ")", "bot");
    } else {
      addMessage(data.text || "No reply.", "bot");
    }
  } catch (e) {
    addMessage("Connection error. Try again.", "bot");
  } finally {
    statusEl.textContent = "";
  }
}

sendBtn.onclick = sendMessage;
input.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });

// Mensagem inicial
addMessage("Hi! I’m your English Mastery Coach. How would you like to practice today?");
</script>
</body>
</html>
