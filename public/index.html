<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Mastery — Text Coach</title>
<style>
  :root {
    --teal:#31c1bb;
    --yellow:#f5b305;
    --orange:#e34410;
    --black:#0C0101;
    --white:#ffffff;
  }
  body {
    font-family: "Poppins", sans-serif;
    background: var(--white);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  header {
    background: var(--teal);
    color: var(--white);
    width: 100%;
    padding: 16px;
    text-align: center;
    font-weight: 600;
    letter-spacing: 0.5px;
  }
  #chat {
    width: 100%;
    max-width: 600px;
    height: 70vh;
    border: 1px solid #ccc;
    border-radius: 12px;
    overflow-y: auto;
    padding: 16px;
    margin-top: 16px;
    background: #f9f9f9;
  }
  .msg {
    margin-bottom: 10px;
    padding: 10px 14px;
    border-radius: 10px;
    max-width: 80%;
    line-height: 1.4;
  }
  .user {
    background: var(--teal);
    color: var(--white);
    align-self: flex-end;
    margin-left: auto;
  }
  .bot {
    background: #fff;
    border: 1px solid #ddd;
  }
  #controls {
    margin-top: 12px;
    display: flex;
    width: 100%;
    max-width: 600px;
    gap: 8px;
  }
  input {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  button {
    background: var(--orange);
    color: var(--white);
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
  }
</style>
</head>
<body>
  <header>English Mastery — Text Coach</header>
  <div id="chat"></div>
  <div id="controls">
    <input type="text" id="input" placeholder="Write your message..." />
    <button id="send">Send</button>
  </div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");

function addMessage(text, who="bot") {
  const msg = document.createElement("div");
  msg.classList.add("msg", who);
  msg.textContent = text;
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  addMessage(text, "user");
  input.value = "";

  // create request to your backend
  const res = await fetch("/session", { method: "POST" });
  const session = await res.json();
  if (!session.client_secret) {
    addMessage("Server error: unable to start session.", "bot");
    return;
  }

  // send message to model using the Responses API
  const reply = await fetch("https://api.openai.com/v1/responses", {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${session.client_secret}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: session.model,
      input: text,
      instructions: "Answer as the English Mastery Coach: friendly, encouraging, and correcting mistakes naturally."
    })
  });

  const data = await reply.json();
  const output = data.output?.[0]?.content?.[0]?.text || "No reply.";
  addMessage(output, "bot");
}

sendBtn.onclick = sendMessage;
input.addEventListener("keydown", e => {
  if (e.key === "Enter") sendMessage();
});
</script>
</body>
</html>
